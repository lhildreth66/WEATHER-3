{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":11,"column":0,"index":226},"end":{"line":11,"column":57,"index":283}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":284},"end":{"line":12,"column":52,"index":336}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":13,"column":0,"index":337},"end":{"line":13,"column":69,"index":406}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":407},"end":{"line":14,"column":26,"index":433}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,_e,_d){\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,\"useSmartDelay\",{enumerable:!0,get:function(){return u}}),Object.defineProperty(_e,\"setupNotificationHandler\",{enumerable:!0,get:function(){return l}});var t=r(_d[0]),n=(function(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),t.default=e,t})(r(_d[1])),o=e(r(_d[2])),s=e(r(_d[3]));const c=process.env.EXPO_PUBLIC_BACKEND_URL||'http://localhost:8000/api',u=()=>{const[e,u]=(0,t.useState)(!1),[l,d]=(0,t.useState)(null),[p,f]=(0,t.useState)(null),[_,y]=(0,t.useState)(null),[h,w]=(0,t.useState)(!1),[E,k]=(0,t.useState)(null),P=(0,t.useCallback)(async()=>{try{d(null);const{status:e}=await n.requestPermissionsAsync(),t='granted'===e;if(u(t),t){return!!await b()}return!1}catch(e){const t=e instanceof Error?e.message:'Unknown error';return d(t),!1}},[]),b=(0,t.useCallback)(async()=>{try{y(null);const e=process.env.EXPO_PUBLIC_EAS_PROJECT_ID;if(!e)throw new Error('EXPO_PUBLIC_EAS_PROJECT_ID not configured');const t=(await n.getExpoPushTokenAsync({projectId:e})).data;return await o.default.setItem('expo_push_token',t),f(t),t}catch(e){const t=e instanceof Error?e.message:'Unknown error';return y(t),null}},[]),S=(0,t.useCallback)(async e=>{try{y(null);let t=p;if(t||(t=await b()),!t)throw new Error('Failed to get push token');return!0===(await s.default.post(`${c}/push/register`,{token:t,subscription_id:e})).data.success}catch(e){const t=e instanceof Error?e.message:'Unknown error';return y(t),!1}},[p]),v=(0,t.useCallback)(async(e,t)=>{try{w(!0),k(null);const n=await s.default.post(`${c}/trips/planned`,{...e,subscription_id:t});if(n.data.trip_id)return n.data.trip_id;throw new Error('No trip_id in response')}catch(e){const t=e instanceof Error?e.message:'Unknown error';return k(t),null}finally{w(!1)}},[]);return(0,t.useEffect)(()=>{(async()=>{try{const e=await o.default.getItem('expo_push_token');e&&f(e)}catch(e){console.warn('Failed to load cached push token:',e)}})()},[]),{requestPermissions:P,permissionsGranted:e,permissionError:l,pushToken:p,getPushToken:b,registerToken:S,tokenError:_,registerPlannedTrip:v,registrationLoading:h,registrationError:E}},l=()=>{n.setNotificationHandler({handleNotification:async e=>({shouldShowAlert:!0,shouldPlaySound:!0,shouldSetBadge:!0})});const e=n.addNotificationReceivedListener(e=>{console.log('[SmartDelay] Notification received:',e.request.content.body)}),t=n.addNotificationResponseReceivedListener(e=>{const t=e.notification.request.content.data;console.log('[SmartDelay] Notification tapped with data:',t),'smart_delay'===t.type&&t.tripId&&console.log(`Navigate to trip ${t.tripId}`)});return()=>{e.remove(),t.remove()}}});","lineCount":1,"map":[[1,144,55,0,"Object"],[1,151,55,0,"defineProperty"],[1,166,55,0,"_e"],[1,169,55,0],[1,186,55,0,"enumerable"],[1,198,55,0],[1,200,55,0,"get"],[1,204,55,0],[1,222,55,0,"useSmartDelay"],[1,223,55,0],[1,227,205,0,"Object"],[1,234,205,0,"defineProperty"],[1,249,205,0,"_e"],[1,252,205,0],[1,280,205,0,"enumerable"],[1,292,205,0],[1,294,205,0,"get"],[1,298,205,0],[1,316,205,0,"setupNotificationHandler"],[1,317,205,0],[1,321,11,0],[1,325,11,0,"_react"],[1,327,11,0,"r"],[1,329,11,0,"_d"],[1,332,11,0],[1,336,12,0,"Notifications"],[1,339],[1,572,12,0,"_interopNamespace"],[1,573,12,0,"r"],[1,575,12,0,"_d"],[1,578,12,0],[1,583,13,0,"AsyncStorage"],[1,585,13,0,"_interopDefault"],[1,587,13,0,"r"],[1,589,13,0,"_d"],[1,592,13,0],[1,597,14,0,"axios"],[1,599,14,0,"_interopDefault"],[1,601,14,0,"r"],[1,603,14,0,"_d"],[1,606,14,0],[1,611,16,0],[1,617,16,6,"API_URL"],[1,619,16,16,"process"],[1,627,16,24,"env"],[1,631,16,28,"EXPO_PUBLIC_BACKEND_URL"],[1,656,16,55],[1,684,55,13,"useSmartDelay"],[1,686,55,29,"useSmartDelay"],[1,691,56,2],[1,697,56,9,"permissionsGranted"],[1,699,56,29,"setPermissionsGranted"],[1,703,56,54],[1,705,56,54,"useState"],[1,707,56,62,"useState"],[1,718,56,63],[1,722,57,9,"permissionError"],[1,724,57,26,"setPermissionError"],[1,728,57,48],[1,730,57,48,"useState"],[1,732,57,56,"useState"],[1,742,57,72],[1,749,58,9,"pushToken"],[1,751,58,20,"setPushToken"],[1,755,58,36],[1,757,58,36,"useState"],[1,759,58,44,"useState"],[1,769,58,60],[1,776,59,9,"tokenError"],[1,778,59,21,"setTokenError"],[1,782,59,38],[1,784,59,38,"useState"],[1,786,59,46,"useState"],[1,796,59,62],[1,803,60,9,"registrationLoading"],[1,805,60,30,"setRegistrationLoading"],[1,809,60,56],[1,811,60,56,"useState"],[1,813,60,64,"useState"],[1,824,60,65],[1,828,61,9,"registrationError"],[1,830,61,28,"setRegistrationError"],[1,834,61,52],[1,836,61,52,"useState"],[1,838,61,60,"useState"],[1,848,61,76],[1,854,64,8,"requestPermissions"],[1,857,64,29],[1,859,64,29,"useCallback"],[1,861,64,40,"useCallback"],[1,874,64,41,"async"],[1,884,65,4],[1,888,66,6,"setPermissionError"],[1,890,66,25],[1,896,68,6],[1,902,68,12,"status"],[1,909,68,14,"status"],[1,918,68,31,"Notifications"],[1,920,68,45,"requestPermissionsAsync"],[1,946,69,12,"granted"],[1,948,69,33],[1,960,69,22,"status"],[1,962,72,6],[1,965,70,6,"setPermissionsGranted"],[1,967,70,28,"granted"],[1,970,72,10,"granted"],[1,972,72,19],[1,973,75,8],[1,987,74,28,"getPushToken"],[1,990,76,6],[1,991,78,6],[1,998,78,13],[1,999,79,4],[1,1000,79,6],[1,1006,79,13,"error"],[1,1009,80,6],[1,1015,80,12,"message"],[1,1017,80,22,"error"],[1,1030,80,39,"Error"],[1,1036,80,47,"error"],[1,1038,80,53,"message"],[1,1046,80,63],[1,1062,82,6],[1,1069,81,6,"setPermissionError"],[1,1071,81,25,"message"],[1,1075,82,13],[1,1076,83,4],[1,1079,84,5],[1,1083,87,8,"getPushToken"],[1,1086,87,23],[1,1088,87,23,"useCallback"],[1,1090,87,34,"useCallback"],[1,1103,87,35,"async"],[1,1113,88,4],[1,1117,89,6,"setTokenError"],[1,1119,89,20],[1,1125,91,6],[1,1131,91,12,"projectId"],[1,1133,91,24,"process"],[1,1141,91,32,"env"],[1,1145,91,36,"EXPO_PUBLIC_EAS_PROJECT_ID"],[1,1172,92,6],[1,1176,92,11,"projectId"],[1,1178,93,8],[1,1184,93,14],[1,1188,93,18,"Error"],[1,1194,93,24],[1,1239,96,6],[1,1245,96,12,"token"],[1,1254,97,14,"Notifications"],[1,1256,97,28,"getExpoPushTokenAsync"],[1,1278,97,50],[1,1279,98,10,"projectId"],[1,1294,100,8,"data"],[1,1299,106,6],[1,1312,103,12,"AsyncStorage"],[1,1314,103,24,"default"],[1,1322,103,25,"setItem"],[1,1330,103,33],[1,1348,103,52,"token"],[1,1351,104,6,"setPushToken"],[1,1353,104,19,"token"],[1,1356,106,13,"token"],[1,1357,107,4],[1,1358,107,6],[1,1364,107,13,"error"],[1,1367,108,6],[1,1373,108,12,"message"],[1,1375,108,22,"error"],[1,1388,108,39,"Error"],[1,1394,108,47,"error"],[1,1396,108,53,"message"],[1,1404,108,63],[1,1420,110,6],[1,1427,109,6,"setTokenError"],[1,1429,109,20,"message"],[1,1432,110,13],[1,1436,111,4],[1,1439,112,5],[1,1443,115,8,"registerToken"],[1,1446,115,24],[1,1448,115,24,"useCallback"],[1,1450,115,35,"useCallback"],[1,1463,116,4,"async"],[1,1473,117,6],[1,1477,118,8,"setTokenError"],[1,1479,118,22],[1,1485,120,8],[1,1489,120,12,"token"],[1,1491,120,20,"pushToken"],[1,1493,125,8],[1,1496,121,13,"token"],[1,1500,122,10,"token"],[1,1508,122,24,"getPushToken"],[1,1514,125,13,"token"],[1,1516,126,10],[1,1522,126,16],[1,1526,126,20,"Error"],[1,1532,126,26],[1,1560,134,8],[1,1567,134,41],[1,1578,129,31,"axios"],[1,1580,129,36,"default"],[1,1588,129,37,"post"],[1,1593,129,42],[1,1596,129,45,"API_URL"],[1,1614,129,70],[1,1615,130,10,"token"],[1,1623,131,10,"subscription_id"],[1,1639,131,27,"subscriptionId"],[1,1644,134,24,"data"],[1,1649,134,29,"success"],[1,1656,135,6],[1,1657,135,8],[1,1663,135,15,"error"],[1,1666,136,8],[1,1672,136,14,"message"],[1,1674,136,24,"error"],[1,1687,136,41,"Error"],[1,1693,136,49,"error"],[1,1695,136,55,"message"],[1,1703,136,65],[1,1719,138,8],[1,1726,137,8,"setTokenError"],[1,1728,137,22,"message"],[1,1732,138,15],[1,1733,139,6],[1,1736,141,4],[1,1737,141,5,"pushToken"],[1,1741,145,8,"registerPlannedTrip"],[1,1744,145,30],[1,1746,145,30,"useCallback"],[1,1748,145,41,"useCallback"],[1,1761,146,4,"async"],[1,1767,146,11,"trip"],[1,1769,146,30,"subscriptionId"],[1,1774,147,6],[1,1778,148,8,"setRegistrationLoading"],[1,1781,148,31],[1,1784,149,8,"setRegistrationError"],[1,1786,149,29],[1,1792,151,8],[1,1798,151,14,"response"],[1,1806,151,31,"axios"],[1,1808,151,36,"default"],[1,1816,151,37,"post"],[1,1821,151,42],[1,1824,151,45,"API_URL"],[1,1842,151,70],[1,1846,152,13,"trip"],[1,1848,153,10,"subscription_id"],[1,1864,153,27,"subscriptionId"],[1,1868,156,8],[1,1871,156,12,"response"],[1,1873,156,21,"data"],[1,1878,156,26,"trip_id"],[1,1886,157,10],[1,1893,157,17,"response"],[1,1895,157,26,"data"],[1,1900,157,31,"trip_id"],[1,1908,160,8],[1,1914,160,14],[1,1918,160,18,"Error"],[1,1924,160,24],[1,1949,161,6],[1,1950,161,8],[1,1956,161,15,"error"],[1,1959,162,8],[1,1965,162,14,"message"],[1,1967,162,24,"error"],[1,1980,162,41,"Error"],[1,1986,162,49,"error"],[1,1988,162,55,"message"],[1,1996,162,65],[1,2012,164,8],[1,2019,163,8,"setRegistrationError"],[1,2021,163,29,"message"],[1,2024,164,15],[1,2028,165,6],[1,2029,165,7],[1,2037,166,8,"setRegistrationLoading"],[1,2040,166,31],[1,2042,167,6],[1,2045,169,4],[1,2049,188,2],[1,2056,173,2],[1,2058,173,2,"useEffect"],[1,2060,173,11,"useEffect"],[1,2071,173,12],[1,2076,174,28,"async"],[1,2087,175,6],[1,2091,176,8],[1,2097,176,14,"cached"],[1,2105,176,29,"AsyncStorage"],[1,2107,176,41,"default"],[1,2115,176,42,"getItem"],[1,2123,176,50],[1,2142,177,12,"cached"],[1,2145,178,10,"setPushToken"],[1,2147,178,23,"cached"],[1,2149,180,6],[1,2150,180,8],[1,2156,180,15,"error"],[1,2159,181,8,"console"],[1,2167,181,16,"warn"],[1,2172,181,21],[1,2208,181,58,"error"],[1,2210,182,6],[1,2213,185,4,"loadCachedToken"],[1,2217,186,5],[1,2221,188,9],[1,2222,189,4,"requestPermissions"],[1,2243,190,4,"permissionsGranted"],[1,2264,191,4,"permissionError"],[1,2282,192,4,"pushToken"],[1,2294,193,4,"getPushToken"],[1,2309,194,4,"registerToken"],[1,2325,195,4,"tokenError"],[1,2338,196,4,"registerPlannedTrip"],[1,2360,197,4,"registrationLoading"],[1,2382,198,4,"registrationError"],[1,2404,205,13,"setupNotificationHandler"],[1,2406,205,40,"setupNotificationHandler"],[1,2411,207,2,"Notifications"],[1,2413,207,16,"setNotificationHandler"],[1,2436,207,39],[1,2437,208,4,"handleNotification"],[1,2456,208,24,"async"],[1,2466,210,13],[1,2467,211,8,"shouldShowAlert"],[1,2484,211,25],[1,2486,212,8,"shouldPlaySound"],[1,2503,212,25],[1,2505,213,8,"shouldSetBadge"],[1,2521,213,24],[1,2527,219,2],[1,2533,219,8,"subscription"],[1,2535,219,23,"Notifications"],[1,2537,219,37,"addNotificationReceivedListener"],[1,2569,219,70,"notification"],[1,2573,220,4,"console"],[1,2581,220,12,"log"],[1,2585,220,16],[1,2623,220,55,"notification"],[1,2625,220,68,"request"],[1,2633,220,76,"content"],[1,2641,220,84,"body"],[1,2649,224,8,"responseSubscription"],[1,2651,224,31,"Notifications"],[1,2653,224,45,"addNotificationResponseReceivedListener"],[1,2693,225,5,"response"],[1,2697,226,6],[1,2703,226,12,"data"],[1,2705,226,19,"response"],[1,2707,226,28,"notification"],[1,2720,226,41,"request"],[1,2728,226,49,"content"],[1,2736,226,57,"data"],[1,2741,227,6,"console"],[1,2749,227,14,"log"],[1,2753,227,18],[1,2799,227,65,"data"],[1,2802,230,24],[1,2818,230,10,"data"],[1,2820,230,15,"type"],[1,2826,230,41,"data"],[1,2828,230,46,"tripId"],[1,2836,231,8,"console"],[1,2844,231,16,"log"],[1,2848,231,20],[1,2868,231,40,"data"],[1,2870,231,45,"tripId"],[1,2882,237,2],[1,2888,237,9],[1,2893,238,4,"subscription"],[1,2895,238,17,"remove"],[1,2904,239,4,"responseSubscription"],[1,2906,239,25,"remove"],[1,2916,241,2],[1,2919]],"functionMap":{"names":["<global>","useSmartDelay","requestPermissions","getPushToken","registerToken","registerPlannedTrip","useEffect$argument_0","loadCachedToken","setupNotificationHandler","Notifications.setNotificationHandler$argument_0.handleNotification","Notifications.addNotificationReceivedListener$argument_0","Notifications.addNotificationResponseReceivedListener$argument_0","<anonymous>"],"mappings":"AAA;6BCsD;yCCS;GDoB;mCEG;GFyB;IGI;KHwB;IIM;KJsB;YKK;4BCC;KDS;GLG;CDc;wCQK;wBCG;KDO;qEEI;GFE;IGI;KHS;SIG;GJG;CRC"},"hasCjsExports":false},"type":"js/module"}]}