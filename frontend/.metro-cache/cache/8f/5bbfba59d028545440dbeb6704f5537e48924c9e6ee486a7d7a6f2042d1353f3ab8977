{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":11,"column":0,"index":226},"end":{"line":11,"column":57,"index":283}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":12,"column":0,"index":284},"end":{"line":12,"column":52,"index":336}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":13,"column":0,"index":337},"end":{"line":13,"column":69,"index":406}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":14,"column":0,"index":407},"end":{"line":14,"column":26,"index":433}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,_e,_d){\"use strict\";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,\"useSmartDelay\",{enumerable:!0,get:function(){return u}}),Object.defineProperty(_e,\"setupNotificationHandler\",{enumerable:!0,get:function(){return l}});var t=r(_d[0]),n=(function(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),t.default=e,t})(r(_d[1])),o=e(r(_d[2])),s=e(r(_d[3]));const c='http://localhost:8000/api',u=()=>{const[e,u]=(0,t.useState)(!1),[l,d]=(0,t.useState)(null),[f,p]=(0,t.useState)(null),[y,h]=(0,t.useState)(null),[w,_]=(0,t.useState)(!1),[k,b]=(0,t.useState)(null),E=(0,t.useCallback)(async()=>{try{d(null);const{status:e}=await n.requestPermissionsAsync(),t='granted'===e;if(u(t),t){return!!await P()}return!1}catch(e){const t=e instanceof Error?e.message:'Unknown error';return d(t),!1}},[]),P=(0,t.useCallback)(async()=>{try{h(null);throw new Error('EXPO_PUBLIC_EAS_PROJECT_ID not configured')}catch(e){const t=e instanceof Error?e.message:'Unknown error';return h(t),null}},[]),S=(0,t.useCallback)(async e=>{try{h(null);let t=f;if(t||(t=await P()),!t)throw new Error('Failed to get push token');return!0===(await s.default.post(`${c}/push/register`,{token:t,subscription_id:e})).data.success}catch(e){const t=e instanceof Error?e.message:'Unknown error';return h(t),!1}},[f]),v=(0,t.useCallback)(async(e,t)=>{try{_(!0),b(null);const n=await s.default.post(`${c}/trips/planned`,{...e,subscription_id:t});if(n.data.trip_id)return n.data.trip_id;throw new Error('No trip_id in response')}catch(e){const t=e instanceof Error?e.message:'Unknown error';return b(t),null}finally{_(!1)}},[]);return(0,t.useEffect)(()=>{(async()=>{try{const e=await o.default.getItem('expo_push_token');e&&p(e)}catch(e){console.warn('Failed to load cached push token:',e)}})()},[]),{requestPermissions:E,permissionsGranted:e,permissionError:l,pushToken:f,getPushToken:P,registerToken:S,tokenError:y,registerPlannedTrip:v,registrationLoading:w,registrationError:k}},l=()=>{n.setNotificationHandler({handleNotification:async e=>({shouldShowAlert:!0,shouldPlaySound:!0,shouldSetBadge:!0})});const e=n.addNotificationReceivedListener(e=>{console.log('[SmartDelay] Notification received:',e.request.content.body)}),t=n.addNotificationResponseReceivedListener(e=>{const t=e.notification.request.content.data;console.log('[SmartDelay] Notification tapped with data:',t),'smart_delay'===t.type&&t.tripId&&console.log(`Navigate to trip ${t.tripId}`)});return()=>{e.remove(),t.remove()}}});","lineCount":1,"map":[[1,144,55,0,"Object"],[1,151,55,0,"defineProperty"],[1,166,55,0,"_e"],[1,169,55,0],[1,186,55,0,"enumerable"],[1,198,55,0],[1,200,55,0,"get"],[1,204,55,0],[1,222,55,0,"useSmartDelay"],[1,223,55,0],[1,227,205,0,"Object"],[1,234,205,0,"defineProperty"],[1,249,205,0,"_e"],[1,252,205,0],[1,280,205,0,"enumerable"],[1,292,205,0],[1,294,205,0,"get"],[1,298,205,0],[1,316,205,0,"setupNotificationHandler"],[1,317,205,0],[1,321,11,0],[1,325,11,0,"_react"],[1,327,11,0,"r"],[1,329,11,0,"_d"],[1,332,11,0],[1,336,12,0,"Notifications"],[1,339],[1,572,12,0,"_interopNamespace"],[1,573,12,0,"r"],[1,575,12,0,"_d"],[1,578,12,0],[1,583,13,0,"AsyncStorage"],[1,585,13,0,"_interopDefault"],[1,587,13,0,"r"],[1,589,13,0,"_d"],[1,592,13,0],[1,597,14,0,"axios"],[1,599,14,0,"_interopDefault"],[1,601,14,0,"r"],[1,603,14,0,"_d"],[1,606,14,0],[1,611,16,0],[1,617,16,6,"API_URL"],[1,619,16,55],[1,647,55,13,"useSmartDelay"],[1,649,55,29,"useSmartDelay"],[1,654,56,2],[1,660,56,9,"permissionsGranted"],[1,662,56,29,"setPermissionsGranted"],[1,666,56,54],[1,668,56,54,"useState"],[1,670,56,62,"useState"],[1,681,56,63],[1,685,57,9,"permissionError"],[1,687,57,26,"setPermissionError"],[1,691,57,48],[1,693,57,48,"useState"],[1,695,57,56,"useState"],[1,705,57,72],[1,712,58,9,"pushToken"],[1,714,58,20,"setPushToken"],[1,718,58,36],[1,720,58,36,"useState"],[1,722,58,44,"useState"],[1,732,58,60],[1,739,59,9,"tokenError"],[1,741,59,21,"setTokenError"],[1,745,59,38],[1,747,59,38,"useState"],[1,749,59,46,"useState"],[1,759,59,62],[1,766,60,9,"registrationLoading"],[1,768,60,30,"setRegistrationLoading"],[1,772,60,56],[1,774,60,56,"useState"],[1,776,60,64,"useState"],[1,787,60,65],[1,791,61,9,"registrationError"],[1,793,61,28,"setRegistrationError"],[1,797,61,52],[1,799,61,52,"useState"],[1,801,61,60,"useState"],[1,811,61,76],[1,817,64,8,"requestPermissions"],[1,820,64,29],[1,822,64,29,"useCallback"],[1,824,64,40,"useCallback"],[1,837,64,41,"async"],[1,847,65,4],[1,851,66,6,"setPermissionError"],[1,853,66,25],[1,859,68,6],[1,865,68,12,"status"],[1,872,68,14,"status"],[1,881,68,31,"Notifications"],[1,883,68,45,"requestPermissionsAsync"],[1,909,69,12,"granted"],[1,911,69,33],[1,923,69,22,"status"],[1,925,72,6],[1,928,70,6,"setPermissionsGranted"],[1,930,70,28,"granted"],[1,933,72,10,"granted"],[1,935,72,19],[1,936,75,8],[1,950,74,28,"getPushToken"],[1,953,76,6],[1,954,78,6],[1,961,78,13],[1,962,79,4],[1,963,79,6],[1,969,79,13,"error"],[1,972,80,6],[1,978,80,12,"message"],[1,980,80,22,"error"],[1,993,80,39,"Error"],[1,999,80,47,"error"],[1,1001,80,53,"message"],[1,1009,80,63],[1,1025,82,6],[1,1032,81,6,"setPermissionError"],[1,1034,81,25,"message"],[1,1038,82,13],[1,1039,83,4],[1,1042,84,5],[1,1046,87,8,"getPushToken"],[1,1049,87,23],[1,1051,87,23,"useCallback"],[1,1053,87,34,"useCallback"],[1,1066,87,35,"async"],[1,1076,88,4],[1,1080,89,6,"setTokenError"],[1,1082,89,20],[1,1088,93,8],[1,1094,93,14],[1,1098,93,18,"Error"],[1,1104,93,24],[1,1148,107,4],[1,1149,107,6],[1,1155,107,13,"error"],[1,1158,108,6],[1,1164,108,12,"message"],[1,1166,108,22,"error"],[1,1179,108,39,"Error"],[1,1185,108,47,"error"],[1,1187,108,53,"message"],[1,1195,108,63],[1,1211,110,6],[1,1218,109,6,"setTokenError"],[1,1220,109,20,"message"],[1,1223,110,13],[1,1227,111,4],[1,1230,112,5],[1,1234,115,8,"registerToken"],[1,1237,115,24],[1,1239,115,24,"useCallback"],[1,1241,115,35,"useCallback"],[1,1254,116,4,"async"],[1,1264,117,6],[1,1268,118,8,"setTokenError"],[1,1270,118,22],[1,1276,120,8],[1,1280,120,12,"token"],[1,1282,120,20,"pushToken"],[1,1284,125,8],[1,1287,121,13,"token"],[1,1291,122,10,"token"],[1,1299,122,24,"getPushToken"],[1,1305,125,13,"token"],[1,1307,126,10],[1,1313,126,16],[1,1317,126,20,"Error"],[1,1323,126,26],[1,1351,134,8],[1,1358,134,41],[1,1369,129,31,"axios"],[1,1371,129,36,"default"],[1,1379,129,37,"post"],[1,1384,129,42],[1,1387,129,45,"API_URL"],[1,1405,129,70],[1,1406,130,10,"token"],[1,1414,131,10,"subscription_id"],[1,1430,131,27,"subscriptionId"],[1,1435,134,24,"data"],[1,1440,134,29,"success"],[1,1447,135,6],[1,1448,135,8],[1,1454,135,15,"error"],[1,1457,136,8],[1,1463,136,14,"message"],[1,1465,136,24,"error"],[1,1478,136,41,"Error"],[1,1484,136,49,"error"],[1,1486,136,55,"message"],[1,1494,136,65],[1,1510,138,8],[1,1517,137,8,"setTokenError"],[1,1519,137,22,"message"],[1,1523,138,15],[1,1524,139,6],[1,1527,141,4],[1,1528,141,5,"pushToken"],[1,1532,145,8,"registerPlannedTrip"],[1,1535,145,30],[1,1537,145,30,"useCallback"],[1,1539,145,41,"useCallback"],[1,1552,146,4,"async"],[1,1558,146,11,"trip"],[1,1560,146,30,"subscriptionId"],[1,1565,147,6],[1,1569,148,8,"setRegistrationLoading"],[1,1572,148,31],[1,1575,149,8,"setRegistrationError"],[1,1577,149,29],[1,1583,151,8],[1,1589,151,14,"response"],[1,1597,151,31,"axios"],[1,1599,151,36,"default"],[1,1607,151,37,"post"],[1,1612,151,42],[1,1615,151,45,"API_URL"],[1,1633,151,70],[1,1637,152,13,"trip"],[1,1639,153,10,"subscription_id"],[1,1655,153,27,"subscriptionId"],[1,1659,156,8],[1,1662,156,12,"response"],[1,1664,156,21,"data"],[1,1669,156,26,"trip_id"],[1,1677,157,10],[1,1684,157,17,"response"],[1,1686,157,26,"data"],[1,1691,157,31,"trip_id"],[1,1699,160,8],[1,1705,160,14],[1,1709,160,18,"Error"],[1,1715,160,24],[1,1740,161,6],[1,1741,161,8],[1,1747,161,15,"error"],[1,1750,162,8],[1,1756,162,14,"message"],[1,1758,162,24,"error"],[1,1771,162,41,"Error"],[1,1777,162,49,"error"],[1,1779,162,55,"message"],[1,1787,162,65],[1,1803,164,8],[1,1810,163,8,"setRegistrationError"],[1,1812,163,29,"message"],[1,1815,164,15],[1,1819,165,6],[1,1820,165,7],[1,1828,166,8,"setRegistrationLoading"],[1,1831,166,31],[1,1833,167,6],[1,1836,169,4],[1,1840,188,2],[1,1847,173,2],[1,1849,173,2,"useEffect"],[1,1851,173,11,"useEffect"],[1,1862,173,12],[1,1867,174,28,"async"],[1,1878,175,6],[1,1882,176,8],[1,1888,176,14,"cached"],[1,1896,176,29,"AsyncStorage"],[1,1898,176,41,"default"],[1,1906,176,42,"getItem"],[1,1914,176,50],[1,1933,177,12,"cached"],[1,1936,178,10,"setPushToken"],[1,1938,178,23,"cached"],[1,1940,180,6],[1,1941,180,8],[1,1947,180,15,"error"],[1,1950,181,8,"console"],[1,1958,181,16,"warn"],[1,1963,181,21],[1,1999,181,58,"error"],[1,2001,182,6],[1,2004,185,4,"loadCachedToken"],[1,2008,186,5],[1,2012,188,9],[1,2013,189,4,"requestPermissions"],[1,2034,190,4,"permissionsGranted"],[1,2055,191,4,"permissionError"],[1,2073,192,4,"pushToken"],[1,2085,193,4,"getPushToken"],[1,2100,194,4,"registerToken"],[1,2116,195,4,"tokenError"],[1,2129,196,4,"registerPlannedTrip"],[1,2151,197,4,"registrationLoading"],[1,2173,198,4,"registrationError"],[1,2195,205,13,"setupNotificationHandler"],[1,2197,205,40,"setupNotificationHandler"],[1,2202,207,2,"Notifications"],[1,2204,207,16,"setNotificationHandler"],[1,2227,207,39],[1,2228,208,4,"handleNotification"],[1,2247,208,24,"async"],[1,2257,210,13],[1,2258,211,8,"shouldShowAlert"],[1,2275,211,25],[1,2277,212,8,"shouldPlaySound"],[1,2294,212,25],[1,2296,213,8,"shouldSetBadge"],[1,2312,213,24],[1,2318,219,2],[1,2324,219,8,"subscription"],[1,2326,219,23,"Notifications"],[1,2328,219,37,"addNotificationReceivedListener"],[1,2360,219,70,"notification"],[1,2364,220,4,"console"],[1,2372,220,12,"log"],[1,2376,220,16],[1,2414,220,55,"notification"],[1,2416,220,68,"request"],[1,2424,220,76,"content"],[1,2432,220,84,"body"],[1,2440,224,8,"responseSubscription"],[1,2442,224,31,"Notifications"],[1,2444,224,45,"addNotificationResponseReceivedListener"],[1,2484,225,5,"response"],[1,2488,226,6],[1,2494,226,12,"data"],[1,2496,226,19,"response"],[1,2498,226,28,"notification"],[1,2511,226,41,"request"],[1,2519,226,49,"content"],[1,2527,226,57,"data"],[1,2532,227,6,"console"],[1,2540,227,14,"log"],[1,2544,227,18],[1,2590,227,65,"data"],[1,2593,230,24],[1,2609,230,10,"data"],[1,2611,230,15,"type"],[1,2617,230,41,"data"],[1,2619,230,46,"tripId"],[1,2627,231,8,"console"],[1,2635,231,16,"log"],[1,2639,231,20],[1,2659,231,40,"data"],[1,2661,231,45,"tripId"],[1,2673,237,2],[1,2679,237,9],[1,2684,238,4,"subscription"],[1,2686,238,17,"remove"],[1,2695,239,4,"responseSubscription"],[1,2697,239,25,"remove"],[1,2707,241,2],[1,2710]],"functionMap":{"names":["<global>","useSmartDelay","requestPermissions","getPushToken","registerToken","registerPlannedTrip","useEffect$argument_0","loadCachedToken","setupNotificationHandler","Notifications.setNotificationHandler$argument_0.handleNotification","Notifications.addNotificationReceivedListener$argument_0","Notifications.addNotificationResponseReceivedListener$argument_0","<anonymous>"],"mappings":"AAA;6BCsD;yCCS;GDoB;mCEG;GFyB;IGI;KHwB;IIM;KJsB;YKK;4BCC;KDS;GLG;CDc;wCQK;wBCG;KDO;qEEI;GFE;IGI;KHS;SIG;GJG;CRC"},"hasCjsExports":false},"type":"js/module"}]}